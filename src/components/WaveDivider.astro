---
interface Props {
  color: string;
  speed?: number;
  size?: number;
  direction?: "left" | "right";
}

const { color, speed = 15, size = 1, direction = "left" } = Astro.props;

// --- LOGIC STAYS EXACTLY THE SAME ---
const waveHeight = 50; 
const curveWidth = 35 * size; 
const waveCycle = curveWidth * 2; 
const totalWidth = Math.ceil(4000 / waveCycle) * waveCycle; 

const generateWavePath = () => {
  let path = `M 0,${waveHeight / 2}`;
  const circles = totalWidth / curveWidth;
  for (let i = 0; i < circles; i++) {
    const x = i * curveWidth;
    const dir = i % 2 === 0 ? -1 : 1;
    const y = (waveHeight / 2) + (15 * size * dir); 
    path += ` Q ${x + curveWidth / 2},${y} ${x + curveWidth},${waveHeight / 2}`;
  }
  return path;
};

const wavePath = generateWavePath();

const cssVars = {
  waveColor: `var(--ctp-${color})`,
  cycleWidth: `${waveCycle}px`,
  animDuration: `${speed / size}s`, 
  halfWidth: `${totalWidth / -2}px` 
};
---

<div class="wave-container">
  <div class="wave-wrapper">
    <svg
      class="wave"
      class:list={[direction === "left" ? "slide-left" : "slide-right"]}
      viewBox={`0 0 ${totalWidth} ${waveHeight}`}
      width={totalWidth}
      height={waveHeight}
      xmlns="http://www.w3.org/2000/svg"
      preserveAspectRatio="xMinYMid slice"
    >
      <path
        d={wavePath}
        stroke="var(--waveColor)"
        stroke-width="3"
        fill="none"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
    </svg>
  </div>
</div>

<style define:vars={{ ...cssVars }}>
  .wave-container {
    /* 1. Constrain width to 70% */
    width: 70%; 
    
    /* 2. Center the container itself */
    margin-inline: auto;
    
    padding: 2rem 0;
    display: flex;
    justify-content: center;
    overflow: hidden;
  }

  /* Optional: On mobile, 70% might look too small, so we reset to 90% or 100% */
  @media (max-width: 768px) {
    .wave-container {
        width: 90%;
    }
  }

  .wave-wrapper {
    width: 100%;
    height: 50px; 
    position: relative;
    /* Mask now applies to the 70% container edge, creating a nice fade */
    mask-image: linear-gradient(to right, transparent 0%, black 15%, black 85%, transparent 100%);
    -webkit-mask-image: linear-gradient(to right, transparent 0%, black 15%, black 85%, transparent 100%);
  }

  .wave {
    position: absolute;
    height: 100%;
    left: 50%;
    margin-left: var(--halfWidth); 
    will-change: transform;
  }

  .slide-left {
    animation: slideLeft var(--animDuration) linear infinite;
  }
  
  .slide-right {
    animation: slideRight var(--animDuration) linear infinite;
  }

  @keyframes slideLeft {
    0% { transform: translateX(0); }
    100% { transform: translateX(calc(var(--cycleWidth) * -1)); }
  }

  @keyframes slideRight {
    0% { transform: translateX(calc(var(--cycleWidth) * -1)); }
    100% { transform: translateX(0); }
  }
</style>